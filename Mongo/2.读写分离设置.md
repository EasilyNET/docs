> 在副本集集群中才涉及到 ReadPreference 的设置,默认情况下,读写都是分发都主节点执行,但是对于写少读多的情况,我们希望进行读写分离来分摊压力,所以希望使用从节点来进行读取,主节点只承担写的责任(实际上写只能分发到主节点,不可修改)

- MongoDB 有 5 种 ReadPreference 模式:

| 模式               | 描述                                                                            |
| ------------------ | ------------------------------------------------------------------------------- |
| primary            | 主节点,默认模式,读操作只在主节点,如果主节点不可用,报错或者抛出异常.             |
| primaryPreferred   | 首选主节点,大多情况下读操作在主节点,如果主节点不可用,如故障转移,读操作在从节点. |
| secondary          | 从节点,读操作只在从节点, 如果从节点不可用,报错或者抛出异常.                     |
| secondaryPreferred | 首选从节点,大多情况下读操作在从节点,特殊情况(如单主节点架构)读操作在主节点.     |
| nearest            | 最邻近节点,读操作在最邻近的成员,可能是主节点或者从节点.                         |

- Mongo 的读写分离非常的简单,只需要在连接字符串中添加如下内容即:

```conf
mongodb://ip1:27017,ip2:27017,ip3:27017/test?readPreference=SecondaryPreferred
```

- /test?readPreference=SecondaryPreferred
- 其他的模式,替换 readPreference 后边的值就行.
- Mongo 建议副本集中的机器数量为奇数,即至少需要 3 台实例.
- 若是 Mongo 做分片集群的模式的话,其实也相当于也通过集群的方式实现了分库分表.
